// src/app/(protected)/reports/_schemas/reports-schema.ts

import { z } from "zod";

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 *  ğŸ”¹ ReportQuerySchema
 *  à¹ƒà¸Šà¹‰ validate à¸à¸²à¸£à¸²à¸¡à¸´à¹€à¸•à¸­à¸£à¹Œà¸—à¸µà¹ˆà¸¡à¸²à¸ˆà¸²à¸ hook/useReports
 *  à¸«à¸£à¸·à¸­à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰ query à¹„à¸›à¸¢à¸±à¸‡ API `/api/reports/categories`
 *
 *  à¸ˆà¸¸à¸”à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ:
 *  - à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸ API à¸”à¹‰à¸§à¸¢à¸›à¸µ/à¹€à¸”à¸·à¸­à¸™à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡
 *  - à¸šà¸±à¸‡à¸„à¸±à¸šà¸„à¹ˆà¸² default à¸‚à¸­à¸‡ type ("expense")
 *  - à¹ƒà¸Šà¹‰à¸£à¹ˆà¸§à¸¡à¹„à¸”à¹‰à¸—à¸±à¹‰à¸‡à¸à¸±à¹ˆà¸‡ client à¹à¸¥à¸° server (universal schema)
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
export const ReportQuerySchema = z.object({
  // year à¹€à¸Šà¹ˆà¸™ 2025 â†’ à¸šà¸±à¸‡à¸„à¸±à¸šà¹€à¸›à¹‡à¸™ int, auto-coerce à¸ˆà¸²à¸ string
  year: z.coerce.number().int().min(2000).max(2100),

  // month à¹€à¸Šà¹ˆà¸™ 1â€“12 â†’ à¹à¸›à¸¥à¸‡ string à¹€à¸›à¹‡à¸™ number à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
  month: z.coerce.number().int().min(1).max(12),

  // type: à¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸¥à¸·à¸­à¸à¹„à¸”à¹‰à¸—à¸±à¹‰à¸‡ income | expense | all
  // à¹ƒà¸Šà¹‰à¸„à¹ˆà¸² default à¹€à¸›à¹‡à¸™ expense à¹€à¸à¸·à¹ˆà¸­à¸„à¸§à¸²à¸¡à¹€à¸‚à¹‰à¸²à¸à¸±à¸™à¸à¸±à¸š API à¹€à¸”à¸´à¸¡
  type: z.enum(["income", "expense", "all"]).default("expense"),
});
export type ReportQuery = z.infer<typeof ReportQuerySchema>;

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 *  ğŸ”¹ TransactionSchema
 *  à¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸š validate à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¹à¸•à¹ˆà¸¥à¸°à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¸”à¸¶à¸‡à¸ˆà¸²à¸ backend
 *
 *  à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸™à¸µà¹‰à¹€à¸›à¹‡à¸™à¸à¸²à¸™à¸‚à¸­à¸‡à¸à¸²à¸£ derive à¸‚à¹‰à¸­à¸¡à¸¹à¸¥:
 *  - buildSummary
 *  - buildMonthlySeries
 *  - buildCategorySeriesForMonth
 *
 *  à¸‚à¹‰à¸­à¸”à¸µ:
 *  - à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸Šà¸™à¸´à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸™à¹ˆà¸™à¸­à¸™ (type safety)
 *  - à¸–à¹‰à¸² backend à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ field â†’ zod à¸ˆà¸° throw error à¸—à¸±à¸™à¸—à¸µ
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
export const TransactionSchema = z.object({
  id: z.number().int(), // PK à¸‚à¸­à¸‡à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡
  tag_id: z.number().int(), // FK à¹„à¸›à¸¢à¸±à¸‡à¸•à¸²à¸£à¸²à¸‡ tag/category
  value: z.number(), // à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™ (à¸­à¸²à¸ˆà¹€à¸›à¹‡à¸™ + à¸«à¸£à¸·à¸­ -)
  date: z.string(), // à¸§à¸±à¸™à¸—à¸µà¹ˆ (ISO à¸«à¸£à¸·à¸­ yyyy-MM-dd)
  time: z.string(), // à¹€à¸§à¸¥à¸² (HH:mm)
  type: z.enum(["income", "expense"]), // à¸›à¸£à¸°à¹€à¸ à¸—à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡
  tag: z.string(), // à¸Šà¸·à¹ˆà¸­à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆ
  note: z.string().optional(), // à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡ (optional)
});
export const TransactionListSchema = z.array(TransactionSchema);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 *  ğŸ”¹ CategoryRowSchema
 *  à¹ƒà¸Šà¹‰à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸Šà¸¸à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆ (category-level summary)
 *  à¸—à¸µà¹ˆ backend à¸ªà¹ˆà¸‡à¸¡à¸²à¸à¸£à¹‰à¸­à¸¡à¸à¸±à¸š transaction
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
export const CategoryRowSchema = z.object({
  category: z.string(), // à¸Šà¸·à¹ˆà¸­à¸«à¸¡à¸§à¸” à¹€à¸Šà¹ˆà¸™ â€œà¸­à¸²à¸«à¸²à¸£â€, â€œà¹€à¸”à¸´à¸™à¸—à¸²à¸‡â€
  expense: z.number().nonnegative(), // à¸¢à¸­à¸”à¸£à¸§à¸¡à¸‚à¸­à¸‡à¸«à¸¡à¸§à¸” (â‰¥ 0)
});
export const CategoryListSchema = z.array(CategoryRowSchema);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 *  ğŸ”¹ ApiPayloadSchema
 *  à¹ƒà¸Šà¹‰ validate à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ response à¸‚à¸­à¸‡ API `/api/reports/categories`
 *
 *  à¸‚à¹‰à¸­à¸”à¸µà¸‚à¸­à¸‡à¸à¸²à¸£à¹ƒà¸Šà¹‰ zod:
 *  - à¸–à¹‰à¸² backend à¸ªà¹ˆà¸‡ field à¹€à¸à¸´à¹ˆà¸¡/à¸‚à¸²à¸” à¸ˆà¸°à¸ˆà¸±à¸šà¹„à¸”à¹‰à¸—à¸±à¸™à¸—à¸µ
 *  - à¹ƒà¸Šà¹‰à¸£à¹ˆà¸§à¸¡à¸à¸±à¸š TypeScript infer à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰ type à¹ƒà¸™à¸à¸±à¹ˆà¸‡ client à¸Šà¸±à¸”à¹€à¸ˆà¸™
 *
 *  à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡ response à¸—à¸µà¹ˆà¸•à¸£à¸§à¸ˆà¹„à¸”à¹‰:
 *  {
 *    ok: true,
 *    data: {
 *      transactions: [...],
 *      categories: [...]
 *    }
 *  }
 *
 *  âœ… à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² default [] â†’ à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ undefined/null à¸ˆà¸²à¸ backend
 * â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
export const ApiPayloadSchema = z.object({
  ok: z.boolean(),
  data: z.object({
    transactions: TransactionListSchema.default([]), // à¸˜à¸¸à¸£à¸à¸£à¸£à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
    categories: CategoryListSchema.default([]), // à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¸ªà¸£à¸¸à¸›
  }),
});
export type ApiPayload = z.infer<typeof ApiPayloadSchema>;
